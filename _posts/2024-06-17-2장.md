2장 어플리케이션 계층


---
## 2.1 네트워크 어플리케이션의 원리

![](https://i.imgur.com/fmVQNbJ.png)
### 네트워크 앱

서로 다른 종단 시스템간 네트워크를 통해 통신

웹 서버 소프트웨어는 브라우저 소프트웨어와 소통

네트워크 코어 기기를 위한 소프트웨어의 필요성

- 사용자 어플리케이션을 작동시키지 않는다

## 어플리케이션 구조

1. 클라이언트-서버
2. peer-to-peer(p2p)

### 클라이언트-서버 구조

서버

- 항상 대기한다
- 영구적인 IP 주소를 가진다
- scaling을 위한 데이터 센터

클라이언트

- 서버와 통신
- 다이나믹 IP 주소를 가진다
- 클라이언트끼리 직접 소통하지 않는다

### P2P 구조

항상 서버에 있지 않는다

확장성이 좋다

## 프로세스 커뮤니케션

프로세스

호스트 내에서 실행되는 프로그램

같은 호스트 사이에서 두 프로세스는 inter-process communication을 통해 소통

다른 호스트 사이의 프로세스는 메세지를 교환하여 소통

![](https://i.imgur.com/9uZeD45.png)

클라이언트 프로세스 - 커뮤니케이션을 시작하는 프로세스

서버 프로세스 - 연결을 기다리는 프로세스

## 어플리케이션 레이어 프로토콜 정의

교환되는 메세지의 종류

요청/응답

메세지 문법

메세지에 어떤 영역이 있는지

필드가 어떻게 나열되어 있는지

메세지 의미

필드에 존재하는 정보의 의미

규칙

언제 어떻게 프로세스가 메세지를 주고 받을지

## HTTP/TCP 프로토콜 구조

HTTP 요청 메세지

![](https://i.imgur.com/Xr6vvIc.png)
버전이 일치해야 해석이 일치한다

## 어플리케이션에 필요한 전송 서비스

- 신뢰성
	일부 어플리케이션은 100% 신뢰 가능한 데이터 이동을 요구
	그 외에는 일부 손실을 용인

- 시간
	인터렉티브 게임, 인터넷 등은 낮은 딜레이를 요구한다

- 전송률

멀티 미디어 어플은 최소한의 전송률을 요구한다

- 암호화

암호화, 데이터 무결성 등

## 인터넷 전송 프로토콜 서비스

### TCP 서비스

- 신뢰성 있는 전송
- 플로우 컨트롤
- 혼잡 제어
- 제공하지 않는 것: 다듬기, 최소 전송량 보장, 보안
- 연결 기반: 서버에서 받을 준비가 되었는지 확인 후 전송

### UDP 서비스

- 신뢰성 없는 전송
- 제공하지 않는 것: 의존성, 플로우 컨트롤, 혼잡 제어, 다듬기, 전송 보장, 보안, 연결 설정

# Web과 HTTP

web이란 인터넷 기반으로 문서를 공유하고 이것이 하이퍼링크로 연결된 서비스이다.

웹 페이지는 HTML 파일, 이미지 파일 등의 객체로 구성되어있다. 각 객체는 URL로 연결 가능하다.

도메인은 호스트 이름, URL은 호스트+경로 이름에 해당한다.

도메인: `www.someschool.edu`

URL: `www.someschool.edu/someDept/pic.gif`

## HTTP 개요

하이퍼 텍스트 전송 프로토콜

웹의 어플리케이션 계층 프로토콜이다.

클라이언트: 웹 오브젝트를 HTTP 프로토콜을 통해 요청/응답받고 보여주는 브라우저

서버: HTTP 프로토콜을 사용하여 요청/응답에 따라 객체를 보내는 웹서버

### TCP를 사용하는 이유

클라이언트가 서버와 TCP 연결을 초기화한다, 80번 포트

서버는 클라이언트 HTTP 메세지로부터 TCP 연결을 받는다

HTTP 메세지는 브라우저와 웹서버 사이에서 교환된다.

TCP 연결을 닫는다.

### HTTP는 비상태 프로토콜

- 서버가 이전에 클라이언트가 요청했던 기록과 정보를 보관하지 않는다
    - 쿠키로 저장한다
- 서버의 부담이 적다
  
> 💡 
> 프로토콜이 상태를 저장하는 것은 복잡하다 이전 기록(상태)는 유지되어야 한다 서버와 클라이언트가 충돌하면 상태에 대한 시점이 일치하지 않기 때문이다  
>  => **정보 일치 문제**

	 
## HTTP 연결

### 비지속적인 HTTP

HTTP 1.0

최소 하나의 객체를 TCP 연결로 전송한 뒤 닫는다

오브젝트를 연결했다 끊었다 한다

다수의 객체를 다운로드 하려면 연결 또한 다수 필요하다

### 지속적인 HTTP

HTTP 1.1

서버와 클라이언트 사이에서 여러 객체를 하나의 TCP 연결을 통해 전송한다.

## HTTP 요청 메세지

클라이언트 측에서 서버쪽으로 보내는 메세지

### method 타입

HTTP/1.0

GET: 서버에게 URL 웹 문서 전송을 요청

HEAD: HTTP Header 정보만 수신

POST: 클라이언트가 서버에 정보를 전송

HTTP/1.1

GET, HEAD, POST

PUT: 엔티티 바디의 파일을 URL 필드에 특정된 경로에 업로드한다

DELETE: URL 필드에 특정된 파일을 삭제한다

## 클라이언트가 서버에 정보를 보내는 방법

### POST method

입력이 엔티티 바디에서 서버에 업로드된다

### URL method

GET 메소드를 사용

입력이 요청 라인의 URL 필드에 업로드 된다

### 쿠키

쿠키는 stateless지만 유저-서버의 status를 남기는 방법을 말한다. 

쿠키는 인증, 장바구니, 추천, 사용자의 세션 상태를 나타내기 위해 사용된다.

#### 쿠키의 구성 요소

1. HTTP 응답의 쿠키 헤더 라인
2. 다음 HTTP 요청 메세지의 쿠키 헤더 라인
3. 쿠키 파일
	사용자의 호스트에 보관되고, 사용자의 브라우저에 의해 관리된다
4. 웹사이트의 백엔드 데이터베이스

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbk3VWk%2Fbtr9QmAnI1a%2Fc3B0u2vUJZLgx1Sw8r8P1k%2Fimg.png)

## 웹 쿠키(프록시 서버)
![[CN Imges/CN 06_1.png]]
### 프록시 서버
- 클라이언트와 근거리에 위치
- 오리진 서버의 일부를 복사해 오리진을 탐색하기 전에 먼저 탐색(캐시 역할)
- 클라이언트의 LAN 내부에 존재

기관의 네트워크에서 오리진 서버로 전송 시 게이트웨이에서 이동(엑세스 링크)에 병목현상이 발생한다. 그러나 엑세스 링크의 속도를 높이는 비용은 비싸기 때문에 LAN 내부에 더 저렴한 웹 캐시를 설치하는 것이다. 

![](https://i.imgur.com/rW61Sxe.png)
오리진 서버의 내용이 특정 날짜 이후로 변경되었는지 확인한다.  

# 이메일

# DNS: Domain Name System
### TLD
top-level domain
- .com, .org, .net 등에 책임
### 권한 DNS 서버
- 조직 소유의 DNS 서버 
- 권한 호스트 이름을 IP 매핑에 제공한다
## DNS 이름 resolution 과정

![](https://i.imgur.com/dmR68uR.png)

권한 DNS 서버를 알게 되면 DNS 서버를 거치지 않고 직접 통신한다.
.edu와 통신한 기록이 있다면 2, 3의 과정을 거치지 않는다.

네임 서버가 매핑하는 법을 알게 되면 매핑을 캐싱한다.

참고로 DNS를 저장하는 기간을 TTL이라고 말한다.


### p2p 어플리케이션

p2p는 항상 서버에 있지 않고 시스템이 직접 peer와 소통한다. 

서버 클라이언트는 가장 그리게 받는 기기의 속도가 영향을 주지만 
p2p는 기기중 제일 빠른 속도가 p2p 파일 전송 시간인 것이다.  


### BitTorrent

**chunk**: 파일을 주고 받을 때의 단위  
**tracker**: torrent에 참여하는 peer 관리 서버  
**torrent**: chunk 파일을 교환하는 peer들의 그룹  

peer는 정보를 tracker에 등록 후 파일 공유가 가능한 peer들 중 일부를 무작위로 얻는다. peer는 그 목록과 세션을 만들어 연결한다.  
torrent에 새로운 peer가 들어오면 공유할 청크가 없지만 시간이 지날수록 chunk가 많아진다.  

**churn**: chunk만 획득하고 나가는 peer  

### chunks 요청

peer들은 서로 다른 chunk를 소유하고 자신이 소유하지 않는 chunk를 보내달라고 요청한다. peer들은 자신의 chunk중 희소성이 큰 것을 먼저 요청한다. 

### chunk 전송 tit-for-tat

peer가 chunk를 공유할 때 자신에게 가장 높은 비율로 chunk를 보내고 있는 peer 4개에게만 보내고 다른 peer들은 chunk를 받지 못한다.  
- 10초마다 peer들을 재평가한다.  
- 30초마다 무작위로 peer를 골라 chunk를 공유한다.  
	- optimistically unchoke, 중단 없이 전송
	- 이를 통해 상위 4개의 peer에 들 수 있다.
    
# 비디오 스트리밍과 컨텐츠 분산 네트워크 
## 멀티미디어

이전 프레임과 비교하여 차이가 있는 것만

## DASH

Dynamic Adaptive Streaming over HTTP

HTTP 통신 방식으로 연결

비디오를 화질에 따라 여러개의 청크로 나눈다

전송 속도에 따라 다른 청크를 보낸다

**manifest file**: 각각의 청크를 관리하는 파일

전송 속도는 클라이언트 측에서 판단하여 어떤 청크를 보낼 지 결정

## 컨텐츠를 위한 네트워크 분산 방식(CDN)

enter-deep

전세계에 나눠 분산

넷플릭스(Akamai)

bring home

데이터 센터를 만들어 좀 더 소수의 장소에 분산

DNS 서버와 책임 DNS 서버를 통해 연결

## 소켓 프로그래밍

UDP/TCP가 존재한다. 

# FTP(File Transfer Protocol)

클라이언트 서버 둘 다 프로세스가 두개 작동

NVT 아스키 코드로 연결

맨 앞 자리가 0인 경우 일반 문자, 1인 경우 컨트롤 제어 문자

파일 종류에는 아스키와 EBCDIC가 있다.
